<UserControl x:Class="BudgetAnalyser.LedgerBook.AddLedgerReconciliationUserControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             IsVisibleChanged="OnIsVisibleChanged">

    <!-- DataContext AddLedgerReconciliationController -->
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <StackPanel Orientation="Horizontal"
                    VerticalAlignment="Top">
            <TextBlock Style="{StaticResource TextBlock.LabelStyle}" 
                       Text="Date:" />
            <DatePicker x:Name="ReconDate"
                        CalendarStyle="{StaticResource CalendarStyle}"
                        DisplayDate="{Binding Date, StringFormat=d}"
                        SelectedDate="{Binding Date}"
                        VerticalAlignment="Center" />
            <TextBlock Margin="20,2,2,2"
                       Style="{StaticResource TextBlock.LabelStyle}"
                       Text="Bank Balance:"
                       Visibility="{Binding AddBalanceVisibility, Converter={StaticResource Converter.BoolToVis}}"/>
            <TextBox GotFocus="OnUIElementGotFocus"
                     Text="{Binding BankBalance, StringFormat=N, UpdateSourceTrigger=PropertyChanged}"
                     Visibility="{Binding AddBalanceVisibility, Converter={StaticResource Converter.BoolToVis}}" />
            <ComboBox ItemsSource="{Binding BankAccounts}"
                      SelectedItem="{Binding SelectedBankAccount}"
                      Visibility="{Binding AddBalanceVisibility, Converter={StaticResource Converter.BoolToVis}}" />
            <Button Command="{Binding AddBankBalanceCommand}"
                    Style="{StaticResource Button.Round.Add}"
                    ToolTip="Add Bank Balance" />
        </StackPanel>

        <Border Background="{StaticResource Brush.MainBackground}"
                BorderBrush="{StaticResource Brush.ControlBorder}"
                BorderThickness="2"
                Grid.Column="1"
                Margin="5,0,5,10"
                MinHeight="40"
                VerticalAlignment="Top">
            <ScrollViewer VerticalScrollBarVisibility="Auto"
                          MinWidth="250">
                <ItemsControl ItemsSource="{Binding BankBalances}"
                              Margin="5">
                </ItemsControl>
            </ScrollViewer>
        </Border>

        <Border Grid.Row="1"
                Grid.Column="1"
                BorderThickness="0,2,0,0"
                BorderBrush="{StaticResource Brush.DefaultText}"
                HorizontalAlignment="Right"
                Width="120">
            <Border BorderThickness="0,2,0,0"
                    BorderBrush="{StaticResource Brush.DefaultText}"
                    Margin="0,2,0,0">
                <TextBlock HorizontalAlignment="Right" 
                           Text="{Binding BankBalanceTotal, StringFormat=N}" />
            </Border>
        </Border>

        <TextBlock Grid.Row="1" 
                   Grid.Column="0"
                   Margin="10,30,10,10"
                   Style="{StaticResource TextBlock.Paragraph}"
                   TextWrapping="Wrap"
                   Visibility="{Binding CreateMode, Converter={StaticResource Converter.BoolToVis}}">
            <Run>
                Use this feature to add a new reconciliation to the ledger book. This will add a new line to the LedgerBook grid.
                The date field is used to date the ledger book line and also to find transactions to include.
                Transactions will be found by searching one month prior to the given date, excluding the given date.
                The idea is to use your pay day as the date, and perform adding a reconciliation once per month.
                The bank balance is the balance as at the date given, after your pay has been credited.
            </Run>
        </TextBlock>
    </Grid>

</UserControl>